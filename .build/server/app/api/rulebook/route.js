"use strict";(()=>{var e={};e.id=780,e.ids=[780],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},40232:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>k,requestAsyncStorage:()=>f,routeModule:()=>z,serverHooks:()=>y,staticGenerationAsyncStorage:()=>g});var o={};t.r(o),t.d(o,{GET:()=>m,POST:()=>_,dynamic:()=>b});var a=t(49303),i=t(88716),n=t(60670),s=t(87070),l=t(8261),u=t(47879),c=t(14749),p=t(7410);let b="force-dynamic",d=p.z.object({eeat:p.z.object({require_author_bio:p.z.boolean(),require_citations:p.z.boolean(),allowed_source_domains:p.z.array(p.z.string()),citation_style:p.z.string(),tone_constraints:p.z.array(p.z.string())}).optional(),seo:p.z.object({title_length:p.z.object({min:p.z.number(),max:p.z.number()}),meta_description:p.z.object({min:p.z.number(),max:p.z.number()}),h1_rules:p.z.object({must_include_primary_keyword:p.z.boolean()}),internal_links_min:p.z.number(),outbound_links_min:p.z.number(),image_alt_required:p.z.boolean(),slug_style:p.z.string()}).optional(),aio:p.z.object({summary_block_required:p.z.boolean(),qa_block_required:p.z.boolean(),structured_data:p.z.array(p.z.string()),answers_should_be_self_contained:p.z.boolean(),content_layout:p.z.array(p.z.string())}).optional(),ai_search_visibility:p.z.object({clear_headings:p.z.boolean(),explicit_facts_with_sources:p.z.boolean(),avoid_fluff:p.z.boolean(),scannability_score_min:p.z.number()}).optional(),prohibited:p.z.object({claims_without_source:p.z.boolean(),fabricated_stats:p.z.boolean(),over_optimization_patterns:p.z.array(p.z.string())}).optional(),score_weights:p.z.object({eeat:p.z.number(),seo:p.z.number(),aio:p.z.number(),ai_search_visibility:p.z.number()}).optional(),enforcement:p.z.object({default_min_quality_score:p.z.number(),block_publish_if_below:p.z.boolean(),tag_if_below:p.z.string()}).optional()});async function m(e){try{let r=await (0,u.pA)(e,{role:"admin",rateLimitConfig:{windowMs:6e4,limit:10}}),t=await l._.globalRulebook.findFirst({orderBy:{version:"desc"}});if(!t)return await (0,c.G)({route:"/api/rulebook",actor:r.email,action:"get_rulebook_not_found"}),s.NextResponse.json({error:"No rulebook found"},{status:404});return await (0,c.G)({route:"/api/rulebook",actor:r.email,action:"get_rulebook_success",metadata:{version:t.version}}),s.NextResponse.json(t)}catch(e){if(e instanceof s.NextResponse)return e;return console.error("Get rulebook error:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}async function _(e){try{let r=await (0,u.pA)(e,{role:"admin",rateLimitConfig:{windowMs:3e5,limit:5}}),{rules:t,sources:o,notes:a}=await e.json();if(!t)return await (0,c.G)({route:"/api/rulebook",actor:r.email,action:"create_rulebook_failed",metadata:{reason:"missing_rules"}}),s.NextResponse.json({error:"Rules are required"},{status:400});try{d.parse(t)}catch(e){return await (0,c.G)({route:"/api/rulebook",actor:r.email,action:"create_rulebook_failed",metadata:{reason:"validation_error",details:e}}),s.NextResponse.json({error:"Invalid rulebook format",details:e},{status:400})}let i=await l._.globalRulebook.findFirst({orderBy:{version:"desc"}}),n=(i?.version||0)+1,p=await l._.globalRulebook.create({data:{version:n,rules:t,sources:o||[],updatedBy:r.email}});return await l._.rulebookVersion.create({data:{version:n,rules:t,sources:o||[],notes:a||`Version ${n} created by ${r.email}`}}),await (0,c.G)({route:"/api/rulebook",actor:r.email,action:"create_rulebook_success",metadata:{version:n,previousVersion:i?.version,rulesKeys:Object.keys(t)}}),s.NextResponse.json(p,{status:201})}catch(e){if(e instanceof s.NextResponse)return e;return console.error("Create rulebook error:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}let z=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/rulebook/route",pathname:"/api/rulebook",filename:"route",bundlePath:"app/api/rulebook/route"},resolvedPagePath:"/tmp/orion-github-clone/app/api/rulebook/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:y}=z,x="/api/rulebook/route";function k(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:g})}},8261:(e,r,t)=>{t.d(r,{_:()=>a});var o=t(53524);let a=global.prisma??new o.PrismaClient({log:["error"]})},14749:(e,r,t)=>{t.d(r,{G:()=>a});let o=[/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g,/\b\d{3}-\d{2}-\d{4}\b/g,/Bearer\s+[A-Za-z0-9+/=_-]+/gi,/password['":]?\s*['"]\w+['"]/gi];async function a(e){console.log("AUDIT_LOG:",JSON.stringify({...e,timestamp:new Date().toISOString(),metadata:e.metadata?function e(r){if("string"==typeof r){let e=r;return o.forEach(r=>{e=e.replace(r,"[REDACTED]")}),e}if(Array.isArray(r))return r.map(e);if("object"==typeof r&&null!==r){let t={};for(let[o,a]of Object.entries(r))["password","token","secret","key"].some(e=>o.toLowerCase().includes(e))?t[o]="[REDACTED]":t[o]=e(a);return t}return r}(e.metadata):void 0}))}},47879:(e,r,t)=>{async function o(e){let r=e.headers.get("authorization");if(!r?.startsWith("Bearer "))return null;let t=r.substring(7);return t&&t.length>10?{id:"test-user-id",email:"test@example.com",name:"Test User",role:"ADMIN"}:null}async function a(e,r){let t=await o(e);if(!t)throw Error("Unauthorized: Valid bearer token required");if(r?.role&&t.role!==r.role&&"ADMIN"!==t.role)throw Error(`Forbidden: ${r.role} role required`);return r?.rateLimitConfig&&console.log("Rate limit config:",r.rateLimitConfig),t}t.d(r,{pA:()=>a}),t(75571)}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[276,972,571,410],()=>t(40232));module.exports=o})();