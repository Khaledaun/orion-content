"use strict";exports.id=15,exports.ids=[15],exports.modules={36783:(t,e,i)=>{i.d(e,{iO:()=>o});let r=[/\b[A-Za-z0-9]{20,}\b/g,/sk-[A-Za-z0-9]{48}/g,/pk_[A-Za-z0-9]{24}/g,/Bearer\s+[A-Za-z0-9\-._~+/]+=*/gi,/postgresql:\/\/[^@]+@[^\/]+\/[^\s]+/gi,/mysql:\/\/[^@]+@[^\/]+\/[^\s]+/gi,/mongodb:\/\/[^@]+@[^\/]+\/[^\s]+/gi,/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g,/password["\s]*[:=]["\s]*[^"\s,}]+/gi,/secret["\s]*[:=]["\s]*[^"\s,}]+/gi,/key["\s]*[:=]["\s]*[^"\s,}]+/gi,/\b\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{4}\b/g,/\b\d{3}-\d{2}-\d{4}\b/g,/\b\d{3}[-.]?\d{3}[-.]?\d{4}\b/g],a=["password","secret","key","token","auth","credential","private","confidential","sensitive","valueEnc","dataEnc"];function s(t){let e=t;for(let t of r)e=e.replace(t,t=>t.length<=4?"*".repeat(t.length):t.substring(0,2)+"*".repeat(t.length-4)+t.substring(t.length-2));return e}function o(t){try{return function t(e){if(null==e)return e;if("string"==typeof e)return s(e);if("number"==typeof e||"boolean"==typeof e)return e;if(Array.isArray(e))return e.map(e=>t(e));if("object"==typeof e){let i={};for(let[r,o]of Object.entries(e)){let e=r.toLowerCase();a.some(t=>e.includes(t))&&"string"==typeof o?i[r]=s(o):i[r]=t(o)}return i}return e}(t)}catch(t){return"[REDACTED - Error during redaction]"}}},49015:(t,e,i)=>{i.d(e,{tu:()=>m,jX:()=>y,fq:()=>h,vX:()=>A,Zz:()=>p,fO:()=>w,Xc:()=>f});var r,a=i(87070),s=i(53524),o=i(7410);!function(t){t.DRAFT="DRAFT",t.PUBLISHED="PUBLISHED",t.ARCHIVED="ARCHIVED"}(r||(r={}));let n=o.z.object({title:o.z.string().min(1,"Title is required").max(200,"Title too long"),slug:o.z.string().min(1,"Slug is required").max(200,"Slug too long"),content:o.z.string().optional(),excerpt:o.z.string().max(500,"Excerpt too long").optional(),status:o.z.nativeEnum(r).default("DRAFT"),publishedAt:o.z.string().datetime().optional(),siteId:o.z.string().min(1,"Site ID is required"),categoryId:o.z.string().optional(),seoData:o.z.object({metaTitle:o.z.string().max(60,"Meta title too long").optional(),metaDescription:o.z.string().max(160,"Meta description too long").optional(),keywords:o.z.array(o.z.string()).default([]),ogTitle:o.z.string().max(60,"OG title too long").optional(),ogDescription:o.z.string().max(160,"OG description too long").optional(),ogImage:o.z.string().url("Invalid OG image URL").optional(),twitterTitle:o.z.string().max(60,"Twitter title too long").optional(),twitterDescription:o.z.string().max(160,"Twitter description too long").optional(),twitterImage:o.z.string().url("Invalid Twitter image URL").optional(),canonicalUrl:o.z.string().url("Invalid canonical URL").optional()}).optional()}),l=o.z.object({title:o.z.string().min(1,"Title is required").max(200,"Title too long").optional(),slug:o.z.string().min(1,"Slug is required").max(200,"Slug too long").optional(),content:o.z.string().optional(),excerpt:o.z.string().max(500,"Excerpt too long").optional(),status:o.z.nativeEnum(r).optional(),publishedAt:o.z.string().datetime().optional(),categoryId:o.z.string().optional(),seoData:o.z.object({metaTitle:o.z.string().max(60,"Meta title too long").optional(),metaDescription:o.z.string().max(160,"Meta description too long").optional(),keywords:o.z.array(o.z.string()).optional(),ogTitle:o.z.string().max(60,"OG title too long").optional(),ogDescription:o.z.string().max(160,"OG description too long").optional(),ogImage:o.z.string().url("Invalid OG image URL").optional(),twitterTitle:o.z.string().max(60,"Twitter title too long").optional(),twitterDescription:o.z.string().max(160,"Twitter description too long").optional(),twitterImage:o.z.string().url("Invalid Twitter image URL").optional(),canonicalUrl:o.z.string().url("Invalid canonical URL").optional()}).optional()}),c=o.z.object({page:o.z.string().transform(Number).pipe(o.z.number().min(1)).default("1"),limit:o.z.string().transform(Number).pipe(o.z.number().min(1).max(100)).default("10"),status:o.z.nativeEnum(r).optional(),siteId:o.z.string().optional(),categoryId:o.z.string().optional(),search:o.z.string().optional(),sortBy:o.z.enum(["createdAt","updatedAt","publishedAt","title"]).default("createdAt"),sortOrder:o.z.enum(["asc","desc"]).default("desc")});class d{constructor(t){this.prisma=t}async createArticle(t,e){let{seoData:i,...r}=t;if(await this.prisma.article.findUnique({where:{slug:t.slug}}))throw Error(`Article with slug '${t.slug}' already exists`);if(!await this.prisma.site.findUnique({where:{id:t.siteId}}))throw Error("Site not found");if(t.categoryId&&!await this.prisma.category.findUnique({where:{id:t.categoryId}}))throw Error("Category not found");return await this.prisma.article.create({data:{...r,authorId:e,publishedAt:t.publishedAt?new Date(t.publishedAt):null,seoData:i?{create:i}:void 0},include:{author:{select:{id:!0,name:!0,email:!0}},site:{select:{id:!0,name:!0,key:!0}},category:{select:{id:!0,name:!0}},seoData:!0,media:!0}})}async getArticles(t){let{page:e,limit:i,status:r,siteId:a,categoryId:s,search:o,sortBy:n,sortOrder:l}=t,c={};r&&(c.status=r),a&&(c.siteId=a),s&&(c.categoryId=s),o&&(c.OR=[{title:{contains:o,mode:"insensitive"}},{content:{contains:o,mode:"insensitive"}},{excerpt:{contains:o,mode:"insensitive"}}]);let[d,u]=await Promise.all([this.prisma.article.findMany({where:c,skip:(e-1)*i,take:i,orderBy:{[n]:l},include:{author:{select:{id:!0,name:!0,email:!0}},site:{select:{id:!0,name:!0,key:!0}},category:{select:{id:!0,name:!0}},seoData:!0,media:!0}}),this.prisma.article.count({where:c})]);return{articles:d,pagination:{page:e,limit:i,total:u,pages:Math.ceil(u/i)}}}async getArticleById(t){let e=await this.prisma.article.findUnique({where:{id:t},include:{author:{select:{id:!0,name:!0,email:!0}},site:{select:{id:!0,name:!0,key:!0}},category:{select:{id:!0,name:!0}},seoData:!0,media:!0}});if(!e)throw Error("Article not found");return e}async getArticleBySlug(t){let e=await this.prisma.article.findUnique({where:{slug:t},include:{author:{select:{id:!0,name:!0,email:!0}},site:{select:{id:!0,name:!0,key:!0}},category:{select:{id:!0,name:!0}},seoData:!0,media:!0}});if(!e)throw Error("Article not found");return e}async updateArticle(t,e,i){let{seoData:r,...a}=e,s=await this.prisma.article.findUnique({where:{id:t},include:{seoData:!0}});if(!s)throw Error("Article not found");if(e.slug&&e.slug!==s.slug&&await this.prisma.article.findUnique({where:{slug:e.slug}}))throw Error(`Article with slug '${e.slug}' already exists`);if(e.categoryId&&!await this.prisma.category.findUnique({where:{id:e.categoryId}}))throw Error("Category not found");let o={...a,publishedAt:e.publishedAt?new Date(e.publishedAt):void 0};return r&&(s.seoData?o.seoData={update:r}:o.seoData={create:r}),await this.prisma.article.update({where:{id:t},data:o,include:{author:{select:{id:!0,name:!0,email:!0}},site:{select:{id:!0,name:!0,key:!0}},category:{select:{id:!0,name:!0}},seoData:!0,media:!0}})}async deleteArticle(t,e){if(!await this.prisma.article.findUnique({where:{id:t}}))throw Error("Article not found");return await this.prisma.article.delete({where:{id:t}}),{success:!0}}async publishArticle(t,e){if(!await this.prisma.article.findUnique({where:{id:t}}))throw Error("Article not found");return await this.prisma.article.update({where:{id:t},data:{status:r.PUBLISHED,publishedAt:new Date},include:{author:{select:{id:!0,name:!0,email:!0}},site:{select:{id:!0,name:!0,key:!0}},category:{select:{id:!0,name:!0}},seoData:!0,media:!0}})}}var u=i(36783);let g=new d(new s.PrismaClient);async function p(t){try{let{searchParams:e}=new URL(t.url),i=c.parse(Object.fromEntries(e)),r=await g.getArticles(i);return console.log(`[ARTICLES] Listed ${r.articles.length} articles (page ${i.page})`),a.NextResponse.json({success:!0,data:r.articles,pagination:r.pagination})}catch(t){return console.error("[ARTICLES] Error listing articles:",(0,u.iO)(t)),a.NextResponse.json({success:!1,error:"Failed to list articles"},{status:500})}}async function m(t){try{let e=await t.json(),i=n.parse(e),r=await g.createArticle(i,"temp-author-id");return console.log(`[ARTICLES] Created article: ${r.title} (${r.slug})`),a.NextResponse.json({success:!0,data:r},{status:201})}catch(i){console.error("[ARTICLES] Error creating article:",(0,u.iO)(i));let t=i instanceof Error?i.message:"Failed to create article",e=t.includes("already exists")?409:t.includes("not found")?404:500;return a.NextResponse.json({success:!1,error:t},{status:e})}}async function h(t,{params:e}){try{let t=await g.getArticleById(e.id);return a.NextResponse.json({success:!0,data:t})}catch(i){console.error(`[ARTICLES] Error getting article ${e.id}:`,(0,u.iO)(i));let t=i instanceof Error?i.message:"Failed to get article";return a.NextResponse.json({success:!1,error:t},{status:"Article not found"===t?404:500})}}async function f(t,{params:e}){try{let i=await t.json(),r=l.parse(i),s=await g.updateArticle(e.id,r,"temp-author-id");return console.log(`[ARTICLES] Updated article: ${s.title} (${s.slug})`),a.NextResponse.json({success:!0,data:s})}catch(r){console.error(`[ARTICLES] Error updating article ${e.id}:`,(0,u.iO)(r));let t=r instanceof Error?r.message:"Failed to update article",i="Article not found"===t?404:t.includes("already exists")?409:t.includes("not found")?404:500;return a.NextResponse.json({success:!1,error:t},{status:i})}}async function y(t,{params:e}){try{return await g.deleteArticle(e.id,"temp-author-id"),console.log(`[ARTICLES] Deleted article: ${e.id}`),a.NextResponse.json({success:!0,message:"Article deleted successfully"})}catch(i){console.error(`[ARTICLES] Error deleting article ${e.id}:`,(0,u.iO)(i));let t=i instanceof Error?i.message:"Failed to delete article";return a.NextResponse.json({success:!1,error:t},{status:"Article not found"===t?404:500})}}async function w(t,{params:e}){try{let t=await g.publishArticle(e.id,"temp-author-id");return console.log(`[ARTICLES] Published article: ${t.title} (${t.slug})`),a.NextResponse.json({success:!0,data:t})}catch(i){console.error(`[ARTICLES] Error publishing article ${e.id}:`,(0,u.iO)(i));let t=i instanceof Error?i.message:"Failed to publish article";return a.NextResponse.json({success:!1,error:t},{status:"Article not found"===t?404:500})}}async function A(t,{params:e}){try{let t=await g.getArticleBySlug(e.slug);return a.NextResponse.json({success:!0,data:t})}catch(i){console.error(`[ARTICLES] Error getting article by slug ${e.slug}:`,(0,u.iO)(i));let t=i instanceof Error?i.message:"Failed to get article";return a.NextResponse.json({success:!1,error:t},{status:"Article not found"===t?404:500})}}}};